# Shell脚本编程进阶实验
FTP、NFS、DHCP、DNS、Samba服务器的自动安装与自动配置

## 实验环境


  - 工作主机(Ubuntu-18.04.4-Server 64bit)：192.168.90.102
  - 目标主机(Ubuntu-18.04.4-Server 64bit)：192.168.90.104

## 实验要求
   参照[chap0x06课件](https://c4pr1c3.github.io/LinuxSysAdmin/chap0x06.md.html#/1)、[shell脚本编程基本要求](https://c4pr1c3.github.io/LinuxSysAdmin/chap0x06.exp.md.html#/shell)
   * FTP
     * 对照第6章课件中的要求选择一款合适的FTP服务器软件支持所有任务要求
   * NFS
     * 对照第6章课件中的NFS服务器配置任务
   * DHCP
     * 2台虚拟机使用Internal网络模式连接，其中一台虚拟机上配置DHCP服务，另一台服务器作为DHCP客户端，从该DHCP服务器获取网络地址配置
   * Samba
     * 对照第6章课件中smbclient一节的3点任务要求完成Samba服务器配置和客户端配置连接测试
   * DNS
     * 基于上述Internal网络模式连接的虚拟机实验环境，在DHCP服务器上配置DNS服务，使得另一台作为DNS客户端的主机可以通过该DNS服务器进行DNS查询
    在DNS服务器上添加`zone "cuc.edu.cn"` 的以下解析记录

           ns.cuc.edu.cn NS
           ns A <自行填写DNS服务器的IP地址>
           wp.sec.cuc.edu.cn A <自行填写第5章实验中配置的WEB服务器的IP地址>
           dvwa.sec.cuc.edu.cn CNAME wp.sec.cuc.edu.cn

## 完成情况
  - [x] FTP自动安装、自动配置
  - [ ] NFS自动安装、自动配置
  - [ ] DHCP自动安装、自动配置
  - [ ] DNS手动安装、手动配置
  - [ ] Samba手动安装、半自动配置

## 实验步骤

### 1. 配置工作主机到目标主机的远程SSH免密登录
```bash
#在工作主机 上生成秘钥对
ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa

#修改目标主机配置文件，允许root用户远程登录
sudo vim /etc/ssh/sshd_config

    #设置可通过口令认证SSH
    PasswordAuthentication yes
    #允许root用户登录
    PermitRootLogin yes

#重启ssh服务
sudo systemctl restart ssh

#将公钥传输至目标主机authorized_keys文件
ssh-copy-id -i ~/.ssh/id_rsa root@192.168.90.104

#测试连接，输入密码登录
ssh root@192.168.90.104

#修改目标主机配置文件
sudo vim /etc/ssh/sshd_config

    PasswordAuthentication no
    PermitRootLogin without-password

sudo systemctl restart ssh

#免密登录
ssh -i ~/.ssh/id_rsa root@192.168.90.104
```
![](img/ssh.png)

### 2. FTP
- 配置文件及脚本
  
  [vsftpd.sh](bash/vsftpd.sh) [vsftpd.conf](config/vsftpd.conf)

- **配置一个提供匿名访问的FTP服务器，匿名访问者可以访问1个目录且仅拥有该目录及其所有子目录的只读访问权限**

  ![](img/ftp.png)

- **配置一个支持用户名和密码方式访问的账号，该账号继承匿名访问者所有权限，且拥有对另1个独立目录及其子目录完整读写（包括创建目录、修改文件、删除文件等）权限，（该账号仅可用于FTP服务访问，不能用于系统shell登录）**

  ![](img/ownuser.png)

- **FTP用户不能越权访问指定目录之外的任意其他目录和文件**

  无论是匿名用户还是非匿名用户都不能访问其他目录文件
  ![](img/failread1.JPG)
  ![](img/failread2.JPG)

- **匿名访问权限仅限白名单IP来源用户访问，禁止白名单IP以外的访问**

  ![](img/cmdftp.JPG)

  
  
